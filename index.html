<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  html, body {
    margin: 0;
    padding: 0;
    background-color: black;
    height: 100vh;
    overflow: auto;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  svg {
    display: block;
    max-width: 100%;
    height: auto;
  }
  .image-mapper-shape {
    fill: transparent;
    stroke: yellow;
    stroke-width: 2px;
    transform-origin: center center;
    transition: transform 0.3s ease, filter 0.3s ease;
  }
  .zoom-part {
    pointer-events: none;
    transition: transform 0.3s ease, filter 0.3s ease, opacity 0.3s ease;
    image-rendering: auto;
  }
  @keyframes glow {
    0% { filter: drop-shadow(0 0 6px red); }
    50% { filter: drop-shadow(0 0 14px yellow); }
    100% { filter: drop-shadow(0 0 6px red); }
  }
</style>
</head>
<body>

<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 2048 4908" preserveAspectRatio="xMidYMid meet">
  <defs id="clip-defs"></defs>

  <g id="main-group" transform="translate(0,0)">
    <image href="image/1.png" xlink:href="image/1.png" width="1024" height="2454" data-src="image/1.png"/>
    <a href="block/physio/1.pdf" target="_blank"><rect x="254" y="423" width="114" height="467" class="image-mapper-shape"/></a>
    <a href="block/histo/1.pdf" target="_blank"><rect x="253" y="1403" width="114" height="438" class="image-mapper-shape"/></a>
    <a href="block/physio/2.pdf" target="_blank"><rect x="484" y="314" width="113" height="459" class="image-mapper-shape"/></a>
    <a href="block/physio/3.pdf" target="_blank"><rect x="488" y="1838" width="108" height="441" class="image-mapper-shape"/></a>
    <a href="block/pharma/1.pdf" target="_blank"><rect x="599" y="422" width="112" height="471" class="image-mapper-shape"/></a>
    <a href="block/bio/1.pdf" target="_blank"><rect x="599" y="893" width="112" height="511" class="image-mapper-shape"/></a>
  </g>

  <g transform="translate(1024,0)">
    <image href="image/2.png" xlink:href="image/2.png" width="1024" height="2454" data-src="image/2.png"/>
  </g>
  <g transform="translate(0,2454)">
    <image href="image/3.png" xlink:href="image/3.png" width="1024" height="2454" data-src="image/3.png"/>
  </g>
  <g transform="translate(1024,2454)">
    <image href="image/4.png" xlink:href="image/4.png" width="1024" height="2454" data-src="image/4.png"/>
  </g>
</svg>

<script>
  const mainGroup = document.getElementById('main-group');
  const clipDefs = document.getElementById('clip-defs');
  const allImages = document.querySelectorAll('image[data-src]');
  const ORIGINAL_IMAGE_HEIGHT = 2454;
  let activeHover = null;

  function detectImageSource(rect) {
    const x = parseFloat(rect.getAttribute('x'));
    const y = parseFloat(rect.getAttribute('y'));
    const px = x + (rect.width.baseVal.value / 2);
    const py = y + (rect.height.baseVal.value / 2);
    let src = allImages[0].getAttribute('data-src');
    allImages.forEach(img => {
      const transform = img.parentNode.getAttribute('transform');
      const tx = transform?.match(/translate\((\d+),?(\d+)?\)/);
      const ix = tx ? parseFloat(tx[1] || 0) : 0;
      const iy = tx ? parseFloat(tx[2] || 0) : 0;
      if (px >= ix && px <= ix + 1024 && py >= iy && py <= iy + ORIGINAL_IMAGE_HEIGHT)
        src = img.getAttribute('data-src');
    });
    return src;
  }

  function attachHover(rect, index) {
    let zoomPart = null;
    const clipPathId = `clip-${index}`;
    const scale = 1.1;

    rect.addEventListener('mouseenter', () => {
      if (activeHover && activeHover !== rect) stopHover();
      startHover();
    });
    rect.addEventListener('mouseleave', stopHover);

    function startHover() {
      activeHover = rect;
      const x = parseFloat(rect.getAttribute('x'));
      const y = parseFloat(rect.getAttribute('y'));
      const width = parseFloat(rect.getAttribute('width'));
      const height = parseFloat(rect.getAttribute('height'));
      const src = detectImageSource(rect);

      const clip = document.createElementNS('http://www.w3.org/2000/svg', 'clipPath');
      clip.id = clipPathId;
      const clipRect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
      Object.assign(clipRect, { x, y, width, height });
      clip.appendChild(clipRect);
      clipDefs.appendChild(clip);

      zoomPart = document.createElementNS('http://www.w3.org/2000/svg', 'image');
      zoomPart.setAttribute('href', src);
      zoomPart.setAttribute('xlink:href', src);
      zoomPart.setAttribute('width', '1024');
      zoomPart.setAttribute('height', ORIGINAL_IMAGE_HEIGHT);
      zoomPart.setAttribute('class', 'zoom-part');
      zoomPart.setAttribute('clip-path', `url(#${clipPathId})`);
      zoomPart.style.transformOrigin = `${x + width / 2}px ${y + height / 2}px`;
      zoomPart.style.opacity = 0;
      mainGroup.appendChild(zoomPart);

      rect.style.transformOrigin = `${x + width / 2}px ${y + height / 2}px`;
      rect.style.transform = `scale(${scale})`;
      rect.style.animation = 'glow 1.5s infinite alternate';
      zoomPart.style.transform = `scale(${scale})`;
      zoomPart.style.opacity = 1;
      zoomPart.style.animation = 'glow 1.5s infinite alternate';
    }

    function stopHover() {
      if (!activeHover) return;
      rect.style.transform = 'scale(1)';
      rect.style.animation = 'none';
      if (zoomPart) zoomPart.remove();
      const existingClip = document.getElementById(clipPathId);
      if (existingClip) existingClip.remove();
      activeHover = null;
    }
  }

  mainGroup.querySelectorAll('.image-mapper-shape').forEach((rect, i) => attachHover(rect, i));
</script>

</body>
</html>