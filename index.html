<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <meta property="og:title" content=" ">
  <meta property="og:description" content=" ">
  <meta property="og:image" content=" ">

  <style>

    html, body {
      margin: 0;
      padding: 0;
      background-color: black;
      height: 100vh;
      overflow: auto;
      display: flex;
      justify-content: center;
      align-items: flex-start;
    }

    svg {
      display: block;
      max-width: 100vw;
      height: 100%;
      width: auto;
    }

    .image-mapper-shape {
      fill: transparent;
      stroke: yellow;
      stroke-width: 2px;
      transform-origin: center center;
      transition: transform 0.3s ease, filter 0.3s ease;
    }
    .image-mapper-shape#red { stroke: red; }

    .zoom-part {
      pointer-events: none;
      transition: transform 0.3s ease, filter 0.3s ease, opacity 0.3s ease;
      image-rendering: auto;
    }
  </style>
</head>
<body>
  <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 2048 4908" preserveAspectRatio="xMidYMid meet" id="main-svg">
    <defs id="clip-defs"></defs>

    <g id="main-group">
      <image x="0" y="0" xlink:href="image/1.png" data-src="image/1.png" width="1024" height="2454"/>
      <image x="1024" y="0" xlink:href="image/2.png" data-src="image/2.png" width="1024" height="2454"/>
      <image x="0" y="2454" xlink:href="image/3.png" data-src="image/3.png" width="1024" height="2454"/>
      <image x="1024" y="2454" xlink:href="image/4.png" data-src="image/4.png" width="1024" height="2454"/>

      <a href="block/physio/1.pdf" target="_blank"><rect x="254" y="423" width="114" height="467" class="image-mapper-shape"/></a>
      <a href="block/histo/1.pdf" target="_blank"><rect x="253" y="1403" width="114" height="438" class="image-mapper-shape"/></a>
      <a href="block/physio/2.pdf" target="_blank"><rect x="484" y="314" width="113" height="459" class="image-mapper-shape"/></a>
      <a href="block/physio/3.pdf" target="_blank"><rect x="488" y="1838" width="108" height="441" class="image-mapper-shape"/></a>
      <a href="block/bio/1.pdf" target="_blank"><rect x="599" y="893" width="112" height="511" class="image-mapper-shape"/></a>
    </g>

    <script>
      const mainSvg = document.getElementById('main-svg'); // Ø¬Ù„Ø¨ Ø¹Ù†ØµØ± Ø§Ù„Ù€ SVG Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
      const mainGroup = document.getElementById('main-group');
      const clipDefs = document.getElementById('clip-defs');
      let activeHover = null;
      const ORIGINAL_IMAGE_HEIGHT = 2454;
      const IMAGE_WIDTH = 1024; // Ø¹Ø±Ø¶ ÙƒÙ„ ØµÙˆØ±Ø© ÙØ±Ø¹ÙŠØ©
      const TOTAL_WIDTH = 2048;

      /**
       * ðŸ› ï¸ Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªØ­Ø¯ÙŠØ¯ Ù…ØµØ¯Ø± ÙˆÙ…ÙˆÙ‚Ø¹ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ·ÙŠÙ„
       * Ø¨Ù…Ø§ Ø£Ù† Ø§Ù„ØµÙˆØ± ÙƒÙ„Ù‡Ø§ Ø¯Ø§Ø®Ù„ Ø¬Ø±ÙˆØ¨ ÙˆØ§Ø­Ø¯ØŒ Ø¨Ù†Ø­Ø¯Ø¯ Ø§Ù„ØµÙˆØ±Ø© Ø¹Ù† Ø·Ø±ÙŠÙ‚ Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ù€ rect
       */
      function getImageData(rectX, rectY) {
          const isRight = rectX >= IMAGE_WIDTH; // Ù‡Ù„ Ø§Ù„Ù…Ø³ØªØ·ÙŠÙ„ ÙÙŠ Ø§Ù„Ù†ØµÙ Ø§Ù„ÙŠÙ…ÙŠÙ†ØŸ
          const isBottom = rectY >= ORIGINAL_IMAGE_HEIGHT; // Ù‡Ù„ Ø§Ù„Ù…Ø³ØªØ·ÙŠÙ„ ÙÙŠ Ø§Ù„Ù†ØµÙ Ø§Ù„Ø£Ø³ÙÙ„ØŸ
          
          let offsetX = isRight ? IMAGE_WIDTH : 0;
          let offsetY = isBottom ? ORIGINAL_IMAGE_HEIGHT : 0;
          let imageIndex = 0; // Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ

          if (!isRight && !isBottom) {
              imageIndex = 1; // image/1.png
          } else if (isRight && !isBottom) {
              imageIndex = 2; // image/2.png
          } else if (!isRight && isBottom) {
              imageIndex = 3; // image/3.png
          } else { // isRight && isBottom
              imageIndex = 4; // image/4.png
          }
          
          const imageElement = mainGroup.querySelector(`image:nth-child(${imageIndex})`);
          const IMAGE_SRC = imageElement ? (imageElement.getAttribute('href') || imageElement.getAttribute('xlink:href')) : 'image/1.png';

          return { 
              src: IMAGE_SRC, 
              offsetX: offsetX, 
              offsetY: offsetY 
          };
      }


      function attachHover(rect, i) {
        let zoomPart = null;
        let animationId = null;
        const clipPathId = `clip-${i}`;
        const scale = 1.1;

        rect.setAttribute('data-index', i);

        // ðŸ›‘ Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù…Ø§ÙˆØ³ ÙˆØ§Ù„Ù„Ù…Ø³ ÙƒÙ…Ø§ Ù‡ÙŠ
        rect.addEventListener('mouseover', startHover);
        rect.addEventListener('mouseout', stopHover);
        rect.addEventListener('touchstart', (e) => {
            if(activeHover && activeHover !== rect) {
                stopHover({target: activeHover});
            }
            if(activeHover === rect) return;
            startHover();
        });
        rect.addEventListener('touchend', stopHover);

        function startHover() {
          if(activeHover === rect) return;
          stopHover({target: rect}); 
          activeHover = rect;

          const x = parseFloat(rect.getAttribute('x'));
          const y = parseFloat(rect.getAttribute('y'));
          const width = parseFloat(rect.getAttribute('width'));
          const height = parseFloat(rect.getAttribute('height'));

          // ðŸ› ï¸ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØµÙˆØ±Ø© ÙˆÙ…ÙˆÙ‚Ø¹Ù‡Ø§
          const imageData = getImageData(x, y);
          const IMAGE_SRC = imageData.src;
          const imageOffsetX = imageData.offsetX;
          const imageOffsetY = imageData.offsetY;
          
          // 1. Ø¥Ù†Ø´Ø§Ø¡ Clip Path
          let clip = document.createElementNS('http://www.w3.org/2000/svg','clipPath');
          clip.setAttribute('id', clipPathId);
          let clipRect = document.createElementNS('http://www.w3.org/2000/svg','rect');
          // Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ù€ clip path Ù‡ÙŠ Ù†ÙØ³Ù‡Ø§ Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ù€ rect
          clipRect.setAttribute('x', x);
          clipRect.setAttribute('y', y);
          clipRect.setAttribute('width', width);
          clipRect.setAttribute('height', height);
          clipDefs.appendChild(clip).appendChild(clipRect);


          // 2. Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ù…ÙƒØ¨Ø±
          zoomPart = document.createElementNS('http://www.w3.org/2000/svg','image');
          zoomPart.setAttribute('href', IMAGE_SRC); // ðŸ› ï¸ Ù…ØµØ¯Ø± Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„ØµØ­ÙŠØ­
          zoomPart.setAttribute('width', IMAGE_WIDTH); // ðŸ› ï¸ Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„ÙˆØ§Ø­Ø¯Ø©
          zoomPart.setAttribute('height', ORIGINAL_IMAGE_HEIGHT); // ðŸ› ï¸ Ø·ÙˆÙ„ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„ÙˆØ§Ø­Ø¯Ø©
          zoomPart.setAttribute('class','zoom-part');
          zoomPart.setAttribute('clip-path', `url(#${clipPathId})`);

          // ðŸ› ï¸ ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…ÙƒØ¨Ø±Ø© Ø¨Ø§Ù„Ù†Ø³Ø¨Ø© Ù„Ù„Ù€ SVG
          // Ø§Ù„Ù€ zoomPart Ø¨ÙŠÙƒÙˆÙ† Ù‡Ùˆ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©ØŒ Ù„ÙƒÙ† Ù„Ø§Ø²Ù… ÙŠØªÙ… ØªØ­Ø±ÙŠÙƒÙ‡ Ø¹Ø´Ø§Ù† ÙŠØªØ·Ø§Ø¨Ù‚ Ù…Ø¹ Ø§Ù„Ù€ rect
          // Ø¹Ø´Ø§Ù† Ø§Ù„Ù€ clipPath Ø¨ÙŠØ³ØªØ®Ø¯Ù… Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ù€ rectØŒ Ù„Ø§Ø²Ù… Ù†Ø­Ø±Ùƒ Ø§Ù„Ù€ zoomPart Ø¹Ø´Ø§Ù† ÙŠØ¬ÙŠ ØªØ­Øª Ø§Ù„Ù€ rect
          
          // Ø¹Ø´Ø§Ù† Ø§Ù„Ø²ÙˆÙ… Ø¨Ø§Ø±Øª Ø¯Ù‡ Ù‡Ùˆ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ© (1024x2454)ØŒ Ù„Ø§Ø²Ù… Ù†Ø­Ø±ÙƒÙ‡ Ø¨Ø§Ù„Ø³Ø§Ù„Ø¨ Ø¹Ø´Ø§Ù† ÙŠØªØ·Ø§Ø¨Ù‚ Ù…Ø¹ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„ÙƒÙ„ÙŠØ©
          // (x) Ùˆ (y) Ø§Ù„Ù„ÙŠ ÙÙŠ Ø§Ù„Ù€ clip path
          zoomPart.setAttribute('x', x - imageOffsetX); 
          zoomPart.setAttribute('y', y - imageOffsetY); 


          // ðŸ› ï¸ ØªØ­Ø¯ÙŠØ¯ Ù…Ø±ÙƒØ² Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù„ÙŠÙƒÙˆÙ† Ù…Ø±ÙƒØ² Ø§Ù„Ù…Ø³ØªØ·ÙŠÙ„
          zoomPart.style.transformOrigin = `${x + width/2}px ${y + height/2}px`;
          zoomPart.style.opacity = 0;
          
          // ðŸ› ï¸ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ù…Ø²ÙˆÙ… Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ù„Ù€ SVG Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„Ø¶Ù…Ø§Ù† Ø¸Ù‡ÙˆØ±Ù‡ ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰
          mainSvg.appendChild(zoomPart);


          // 3. ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª
          rect.style.transformOrigin = `${x + width/2}px ${y + height/2}px`;
          rect.style.transform = `scale(${scale})`;
          zoomPart.style.transform = `scale(${scale})`;
          zoomPart.style.opacity = 1;

          // 4. ØªØ´ØºÙŠÙ„ Ø§Ù„ÙˆÙ‡Ø¬
          let hue = 0;
          animationId = setInterval(() => {
            hue = (hue + 1) % 360;
            const glow = `drop-shadow(0 0 8px hsl(${hue},100%,55%)) drop-shadow(0 0 14px hsl(${(hue+60)%360},100%,60%))`;
            rect.style.filter = glow;
            if(zoomPart) zoomPart.style.filter = glow;
          }, 100);
        }

        function stopHover(e) {
          const targetRect = e ? (e.target.tagName === 'rect' ? e.target : e.target.closest('a')?.querySelector('.image-mapper-shape')) : rect;

          if(!targetRect || targetRect !== rect) {
              if(activeHover === targetRect) activeHover = null; 
              return; 
          }

          if(animationId) clearInterval(animationId);
          animationId = null; 

          rect.style.transform = 'scale(1)';
          rect.style.filter = 'none';

          if(zoomPart){ zoomPart.remove(); zoomPart = null; }

          const currentClip = document.getElementById(clipPathId);
          if(currentClip) currentClip.remove();

          if(activeHover === rect) {
              activeHover = null;
          }
        }
      }

      mainGroup.querySelectorAll('.image-mapper-shape').forEach((rect, i) => attachHover(rect, i));

      const observer = new MutationObserver(mutations => {
        mutations.forEach(mutation => {
          mutation.addedNodes.forEach((node, i) => {
            if(node.tagName==='A'){
              const rect = node.querySelector('rect.image-mapper-shape');
              if(rect) attachHover(rect, Date.now()+i);
            }
          });
        });
      });
      observer.observe(mainGroup,{childList:true, subtree:true});
    </script>
</body>
</html>
