<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø®Ø±ÙŠØ·Ø© ØªÙØ§Ø¹Ù„ÙŠØ© Ù†Ø¸ÙŠÙØ©</title>
  <style>

    html, body {
      margin: 0;
      padding: 0;
      background-color: black;
      height: 100vh;
      overflow: auto;
      display: flex;
      justify-content: center;
      align-items: flex-start;
    }

    svg {
      display: block;
      max-width: 100vw;
      height: 100%;
      width: auto;
    }

    .image-mapper-shape {
      fill: transparent;
      stroke: yellow;
      stroke-width: 2px;
      transform-origin: center center;
      transition: transform 0.3s ease, filter 0.3s ease;
    }
    .image-mapper-shape#red { stroke: red; }

    .zoom-part {
      pointer-events: none;
      transition: transform 0.3s ease, filter 0.3s ease, opacity 0.3s ease;
      image-rendering: auto;
    }
  </style>
</head>
<body>
  <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 2048 4908" preserveAspectRatio="xMidYMid meet">
    <defs id="clip-defs"></defs>

    <g id="main-group">
      <image x="0" y="0" xlink:href="image/1.png" data-src="image/1.png" width="1024" height="2454"/>
      <image x="1024" y="0" xlink:href="image/2.png" data-src="image/2.png" width="1024" height="2454"/>
      <image x="0" y="2454" xlink:href="image/3.png" data-src="image/3.png" width="1024" height="2454"/>
      <image x="1024" y="2454" xlink:href="image/4.png" data-src="image/4.png" width="1024" height="2454"/>

      <a href="block/physio/1.pdf" target="_blank"><rect x="254" y="423" width="114" height="467" class="image-mapper-shape"/></a>
      <a href="block/histo/1.pdf" target="_blank"><rect x="253" y="1403" width="114" height="438" class="image-mapper-shape"/></a>
      <a href="block/physio/2.pdf" target="_blank"><rect x="484" y="314" width="113" height="459" class="image-mapper-shape"/></a>
      <a href="block/physio/3.pdf" target="_blank"><rect x="488" y="1838" width="108" height="441" class="image-mapper-shape"/></a>
      <a href="block/bio/1.pdf" target="_blank"><rect x="599" y="893" width="112" height="511" class="image-mapper-shape"/></a>
    </g>  
    <script>
      const mainGroup = document.getElementById('main-group');
      const clipDefs = document.getElementById('clip-defs');
      // activeHover Ø¯Ù„ÙˆÙ‚ØªÙŠ Ù‡ÙŠÙ…Ø³Ùƒ Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ù„ÙŠ ÙÙŠÙ‡ Ø§Ù„Ù‡Ø§ÙØ± Ø­Ø§Ù„ÙŠØ§Ù‹
      let activeHover = null; 
      const ORIGINAL_IMAGE_HEIGHT = 2454;

      // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ø¥ÙŠØ¬Ø§Ø¯ Ø¹Ù†ØµØ± Ø§Ù„Ù€ zoomPart Ø§Ù„Ù…Ø±ØªØ¨Ø· Ø¨Ù€ rect
      function getZoomPart(rect) {
          const clipId = `clip-${rect.getAttribute('data-index')}`;
          // Ù„Ø§Ø²Ù… Ù†Ø¨Ø­Ø« ÙÙŠ mainGroup Ø¹Ù† Ø§Ù„Ù€ zoom-part Ø§Ù„Ù„ÙŠ Ø¨ÙŠØ³ØªØ®Ø¯Ù… Ø§Ù„Ù€ clip-path Ø¯Ù‡
          return mainGroup.querySelector(`.zoom-part[clip-path="url(#${clipId})"]`);
      }

      function attachHover(rect, i) {
        let zoomPart = null;
        let clipPathId = `clip-${i}`;
        let animationId = null;
        const scale = 1.1;

        // Ø¨Ù†Ø­Ø· index Ø¹Ø´Ø§Ù† Ù†Ø¹Ø±Ù Ù†Ù„Ø§Ù‚ÙŠ Ø§Ù„Ù€ clip path ÙˆØ§Ù„Ù€ zoom part Ù„Ù…Ø§ Ù†Ø¹Ù…Ù„ stopHover Ø¹Ù„Ù‰ Ø¹Ù†ØµØ± ØªØ§Ù†ÙŠ
        rect.setAttribute('data-index', i); 

        // ğŸ›‘ Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù…Ø§ÙˆØ³
        rect.addEventListener('mouseover', startHover);
        rect.addEventListener('mouseout', stopHover);

        // ğŸ›‘ Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù„Ù…Ø³
        rect.addEventListener('touchstart', (e) => {
          // e.preventDefault(); // ÙŠÙ…ÙƒÙ† ØªØ³ÙŠØ¨ Ø¯ÙŠ Ù„Ùˆ Ø¹Ø§ÙŠØ² ØªÙ…Ù†Ø¹ Ø§Ù„Ù€ scroll Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù„Ù…Ø³ Ø§Ù„Ø·ÙˆÙŠÙ„
          
          if(activeHover && activeHover !== rect) {
              // ğŸ›‘ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù‡Ø§ÙØ± Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„Ùˆ ÙƒØ§Ù† Ø´ØºØ§Ù„ Ø¹Ù„Ù‰ Ø¹Ù†ØµØ± ØªØ§Ù†ÙŠ
              stopHover({target: activeHover});
          }
          if(activeHover === rect) return;
          startHover();
        });
        
        // ğŸ›‘ Ø¹Ù†Ø¯ Ø±ÙØ¹ Ø§Ù„Ø¥ØµØ¨Ø¹ØŒ Ø¨ÙŠØªÙˆÙ‚Ù Ø§Ù„Ù‡Ø§ÙØ± ÙˆØ¨ÙŠØ³Ù…Ø­ Ù„Ù„Ø±Ø§Ø¨Ø· ÙŠÙØªØ­
        rect.addEventListener('touchend', stopHover);

        // ğŸ›‘ Ø¯Ø§Ù„Ø© Ø§Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø¹Ø¯Ù„Ø©
        function startHover(e) {
          
          // ğŸ›‘ ØªØ£ÙƒÙŠØ¯: Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù‡Ø§ÙØ± Ø§Ù„Ø³Ø§Ø¨Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø´ØºØ§Ù„ Ø¹Ù„Ù‰ Ø¹Ù†ØµØ± ØªØ§Ù†ÙŠ
          if(activeHover && activeHover !== rect) {
             // Ø¹Ø´Ø§Ù† Ù†Ø¶Ù…Ù† Ø¥Ù†Ù†Ø§ Ø¨Ù†ÙˆÙ‚Ù Ø§Ù„Ù‡Ø§ÙØ± Ø§Ù„ØµØ­ØŒ Ø¨Ù†Ø¨Ø¹Øª Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ù‚Ø¯ÙŠÙ… Ù„Ø¯Ø§Ù„Ø© stopHover
             stopHover({target: activeHover});
          }

          // Ù„Ùˆ Ø§Ù„Ù‡Ø§ÙØ± Ø´ØºØ§Ù„ Ø¨Ø§Ù„ÙØ¹Ù„ Ø¹Ù„Ù‰ Ù†ÙØ³ Ø§Ù„Ø¹Ù†ØµØ±ØŒ Ù…Ø´ Ø¨Ù†Ø¹Ù…Ù„ Ø­Ø§Ø¬Ø©
          if(activeHover === rect) return;
            
          activeHover = rect;
          
          const x = parseFloat(rect.getAttribute('x'));
          const y = parseFloat(rect.getAttribute('y'));
          const width = parseFloat(rect.getAttribute('width'));
          const height = parseFloat(rect.getAttribute('height'));

          // Ø¥Ù†Ø´Ø§Ø¡ Clip Path
          let clip = document.createElementNS('http://www.w3.org/2000/svg','clipPath');
          clip.setAttribute('id', clipPathId);
          let clipRect = document.createElementNS('http://www.w3.org/2000/svg','rect');
          clipRect.setAttribute('x', x);
          clipRect.setAttribute('y', y);
          clipRect.setAttribute('width', width);
          clipRect.setAttribute('height', height);
          clip.appendChild(clipRect);
          clipDefs.appendChild(clip);

          // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ù…ÙƒØ¨Ø±
          zoomPart = document.createElementNS('http://www.w3.org/2000/svg','image');
          zoomPart.setAttribute('href','image/1.png');
          zoomPart.setAttribute('width','1024');
          zoomPart.setAttribute('height', ORIGINAL_IMAGE_HEIGHT);
          zoomPart.setAttribute('class','zoom-part');
          zoomPart.setAttribute('clip-path', `url(#${clipPathId})`);
          zoomPart.style.transformOrigin = `${x + width/2}px ${y + height/2}px`;
          zoomPart.style.opacity = 0;
          mainGroup.appendChild(zoomPart);

          // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª
          rect.style.transformOrigin = `${x + width/2}px ${y + height/2}px`;
          rect.style.transform = `scale(${scale})`;
          zoomPart.style.transform = `scale(${scale})`;
          zoomPart.style.opacity = 1;

          // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£Ù†Ù…ÙŠØ´Ù†
          let hue = 0;
          animationId = setInterval(() => {
            hue = (hue + 1) % 360;
            const glow = `drop-shadow(0 0 8px hsl(${hue},100%,55%)) drop-shadow(0 0 14px hsl(${(hue+60)%360},100%,60%))`;
            rect.style.filter = glow;
            zoomPart.style.filter = glow;
          }, 100);
        }

        // ğŸ›‘ Ø¯Ø§Ù„Ø© Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø¹Ø¯Ù„Ø©
        function stopHover(e) {
          // Ø¨Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ù„ÙŠ Ø¹Ù„ÙŠÙ‡ Ø§Ù„Ø­Ø¯Ø« Ù„Ùˆ Ù…ÙˆØ¬ÙˆØ¯ØŒ Ù„Ùˆ Ù…Ø´ Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ø­Ø§Ù„ÙŠ (rect)
          const targetRect = e ? (e.target.tagName === 'rect' ? e.target : e.target.querySelector('rect.image-mapper-shape')) : rect;
          
          if(!targetRect || activeHover !== targetRect) return; // Ø¨Ù†ÙˆÙ‚Ù Ø¨Ø³ Ù„Ùˆ Ù‡Ùˆ Ø¯Ù‡ Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ù†Ø´Ø·

          targetRect.style.transform = 'scale(1)';
          targetRect.style.filter = 'none';
          
          // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø£Ù†Ù…ÙŠØ´Ù†
          const currentAnimationId = setInterval(()=>{},0);
          for (let i = animationId + 1; i <= currentAnimationId; i++) {
              clearInterval(i);
          }
          
          // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù€ zoom part ÙˆØ§Ù„Ù€ clip path
          const currentZoomPart = getZoomPart(targetRect);
          const currentClip = document.getElementById(`clip-${targetRect.getAttribute('data-index')}`);

          if(currentZoomPart){ currentZoomPart.remove(); zoomPart = null; }
          if(currentClip) currentClip.remove();
          
          activeHover = null;
        }
      }

      mainGroup.querySelectorAll('.image-mapper-shape').forEach((rect, i) => attachHover(rect, i));

      const observer = new MutationObserver(mutations => {
        mutations.forEach(mutation => {
          mutation.addedNodes.forEach((node, i) => {
            if(node.tagName==='A'){
              const rect = node.querySelector('rect.image-mapper-shape');
              if(rect) attachHover(rect, Date.now()+i);
            }
          });
        });
      });
      observer.observe(mainGroup,{childList:true, subtree:true});
    </script>
</body>
</html>
