<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>خريطة تفاعلية صحيحة</title>
<style>
html, body {
  margin: 0;
  padding: 0;
  background: black;
  height: 100vh;
  overflow: hidden;
  display: flex;
  justify-content: center;
  align-items: flex-start;
}
svg {
  display: block;
  height: 100%;
  width: auto;
}
.image-mapper-shape {
  fill: transparent;
  stroke: yellow;
  stroke-width: 2px;
  transform-origin: center center;
  transition: transform 0.3s ease, filter 0.3s ease;
  pointer-events: all;
  cursor: pointer;
}
.zoom-part {
  pointer-events: none;
  transition: transform 0.3s ease, opacity 0.3s ease;
}
</style>
</head>
<body>

<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 2454" preserveAspectRatio="xMidYMid meet">
  <defs id="clip-defs"></defs>
  <g id="main-group">
    <image href="image/1.png" width="1024" height="2454" class="base-image"/>
    <a href="block/physio/1.pdf" target="_blank"><rect x="368" y="703" width="115" height="380" class="image-mapper-shape"/></a>
    <a href="block/histo/1.pdf" target="_blank"><rect x="368" y="1083" width="115" height="253.5" class="image-mapper-shape"/></a>
    <a href="block/physio/2.pdf" target="_blank"><rect x="368" y="1465" width="115" height="380" class="image-mapper-shape"/></a>
  </g>
</svg>

<script>
const clipDefs = document.getElementById('clip-defs');
const mainGroup = document.getElementById('main-group');

document.querySelectorAll('.image-mapper-shape').forEach((rect, index) => {
  let zoomPart = null;
  let clipId = `clip-${index}`;
  const scale = 1.1;

  function startHover() {
    if (zoomPart) return;
    const x = parseFloat(rect.getAttribute('x'));
    const y = parseFloat(rect.getAttribute('y'));
    const width = parseFloat(rect.getAttribute('width'));
    const height = parseFloat(rect.getAttribute('height'));

    // إنشاء clipPath
    const clip = document.createElementNS('http://www.w3.org/2000/svg','clipPath');
    clip.setAttribute('id', clipId);
    const clipRect = document.createElementNS('http://www.w3.org/2000/svg','rect');
    clipRect.setAttribute('x', x);
    clipRect.setAttribute('y', y);
    clipRect.setAttribute('width', width);
    clipRect.setAttribute('height', height);
    clip.appendChild(clipRect);
    clipDefs.appendChild(clip);

    // إنشاء صورة الزوم
    zoomPart = document.createElementNS('http://www.w3.org/2000/svg','image');
    zoomPart.setAttribute('href','image/1.png');
    zoomPart.setAttribute('width','1024');
    zoomPart.setAttribute('height','2454');
    zoomPart.setAttribute('class','zoom-part');
    zoomPart.setAttribute('clip-path', `url(#${clipId})`);
    zoomPart.style.transformOrigin = `${x + width/2}px ${y + height/2}px`;
    zoomPart.style.transform = `scale(${scale})`;
    zoomPart.style.opacity = 1;

    mainGroup.appendChild(zoomPart);

    rect.style.transformOrigin = `${x + width/2}px ${y + height/2}px`;
    rect.style.transform = `scale(${scale})`;
  }

  function stopHover() {
    rect.style.transform = 'scale(1)';
    if (zoomPart) zoomPart.remove();
    const existingClip = document.getElementById(clipId);
    if (existingClip) existingClip.remove();
    zoomPart = null;
  }

  // ماوس
  rect.addEventListener('mouseenter', startHover);
  rect.addEventListener('mouseleave', stopHover);

  // لمس
  rect.addEventListener('touchstart', e => {
    e.preventDefault();
    startHover();
  }, {passive:false});

  rect.addEventListener('touchend', e => {
    stopHover();
    const link = rect.closest('a');
    if(link) window.open(link.href, link.target || '_self');
  });
});
</script>

</body>
</html>